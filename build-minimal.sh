#!/usr/bin/env bash# ============================================================================# build-minimal.sh - Fast build script for minimal MSBuild assemblies only# # This script builds only the essential MSBuild runtime without tests, samples,# or package projects. It is significantly faster than a full build.## Usage:#   ./build-minimal.sh                  - Build with bootstrap (default)#   ./build-minimal.sh --nobootstrap    - Build without bootstrap (fastest)#   ./build-minimal.sh --release        - Build release configuration#   ./build-minimal.sh --netcore        - Build only .NET Core#   ./build-minimal.sh --help           - Show help# ============================================================================set -eSCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"REPO_ROOT="$SCRIPT_DIR"# Default valuesCONFIGURATION="Debug"CREATE_BOOTSTRAP="true"REBUILD=""RESTORE="true"BUILD="true"VERBOSITY="minimal"EXTRA_ARGS=""TARGET_FRAMEWORK_FILTER=""show_help() {    echo ""    echo "MSBuild Minimal Build Script - Fast build for development"    echo ""    echo "Usage: ./build-minimal.sh [options]"    echo ""    echo "Options:"    echo "  --nobootstrap    Skip creating the bootstrap folder (fastest builds)"    echo "  --release        Build in Release configuration (default: Debug)"    echo "  --debug          Build in Debug configuration"    echo "  --rebuild        Force a rebuild (clean + build)"    echo "  --restore        Restore only, don't build"    echo "  --netcore, --core Build only .NET Core target"    echo "  -v <level>       Verbosity: q[uiet], m[inimal], n[ormal], d[etailed]"    echo "  --help           Show this help"    echo ""    echo "Examples:"    echo "  ./build-minimal.sh                     Minimal build with bootstrap"    echo "  ./build-minimal.sh --nobootstrap       Fast incremental build"    echo "  ./build-minimal.sh --netcore           .NET Core only (faster)"    echo "  ./build-minimal.sh --release           Release build"    echo ""    echo "For full builds including tests, use: ./build.sh"    echo ""    exit 0}# Parse argumentswhile [[ $# -gt 0 ]]; do    case "$1" in        --help|-h)            show_help            ;;        --nobootstrap|-nobootstrap)            CREATE_BOOTSTRAP="false"            shift            ;;        --release|-release)            CONFIGURATION="Release"            shift            ;;        --debug|-debug)            CONFIGURATION="Debug"            shift            ;;        --rebuild|-rebuild)            REBUILD="--rebuild"            shift            ;;        --restore|-restore)            BUILD=""            shift            ;;        --netcore|-netcore|--core|-core)            TARGET_FRAMEWORK_FILTER="net10.0"            shift            ;;        -v|--verbosity)            VERBOSITY="$2"            shift 2            ;;        *)            EXTRA_ARGS="$EXTRA_ARGS $1"            shift            ;;    esacdone# Build argumentsBUILD_ARGS="--restore --configuration $CONFIGURATION -v $VERBOSITY"if [[ -n "$BUILD" ]]; then    BUILD_ARGS="$BUILD_ARGS --build"fiif [[ -n "$REBUILD" ]]; then    BUILD_ARGS="$BUILD_ARGS $REBUILD"fiBUILD_ARGS="$BUILD_ARGS /p:CreateBootstrap=$CREATE_BOOTSTRAP"# Target framework filterif [[ -n "$TARGET_FRAMEWORK_FILTER" ]]; then    BUILD_ARGS="$BUILD_ARGS /p:TargetFrameworks=$TARGET_FRAMEWORK_FILTER"fi# Use solution filter for minimal projects onlyBUILD_ARGS="$BUILD_ARGS /p:Projects=$REPO_ROOT/MSBuild.Minimal.slnf"echo ""echo "============================================================"echo " MSBuild Minimal Build"echo "============================================================"echo " Configuration:    $CONFIGURATION"echo " Create Bootstrap: $CREATE_BOOTSTRAP"echo " Verbosity:        $VERBOSITY"if [[ -n "$TARGET_FRAMEWORK_FILTER" ]]; then    echo " Target Framework: $TARGET_FRAMEWORK_FILTER"fiecho "============================================================"echo ""# Run the build"$REPO_ROOT/eng/common/build.sh" $BUILD_ARGS $EXTRA_ARGSEXIT_CODE=$?if [[ $EXIT_CODE -eq 0 ]]; then    echo ""    echo "============================================================"    echo " Build succeeded!"    if [[ "$CREATE_BOOTSTRAP" == "true" ]]; then        echo ""        echo " To use the bootstrapped MSBuild, run:"        echo "   source artifacts/sdk-build-env.sh"        echo ""        echo " Then use 'dotnet build' with your locally-built MSBuild."    fi    echo "============================================================"fiexit $EXIT_CODE