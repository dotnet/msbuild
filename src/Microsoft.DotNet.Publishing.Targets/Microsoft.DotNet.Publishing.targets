<!--
***********************************************************************************************
Microsoft.DotNet.Publishing.targets  

WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your web deploy projects from the command-line or the IDE.

This file defines the steps in the standard build process to deploy web application projects.

Copyright (C) Microsoft Corporation. All rights reserved.
***********************************************************************************************
-->

<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="$(MSBuildThisFileDirectory)\..\Microsoft.DotNet.Publishing.Props" Condition="Exists('$(MSBuildThisFileDirectory)\..\Microsoft.DotNet.Publishing.Props')"/>
  <Import Project="$(DotNetPublishingSaveFilesDirectory)Microsoft.DotNet.Publishing.SaveFiles.targets" Condition="Exists('$(DotNetPublishingSaveFilesDirectory)Microsoft.DotNet.Publishing.SaveFiles.targets')"/>

  <!--
  ***********************************************************************************************
  Import the Collection target
  ***********************************************************************************************
 -->
  
  <PropertyGroup>
    <PublishProjectType Condition="'$(PublishProjectType)' == '' and '$(TargetFrameworkIdentifier)' == '.NETCoreApp' ">Core</PublishProjectType> 
    <PublishProjectType Condition="'$(PublishProjectType)' == '' and '$(OutputType)' =='Exe' ">Console</PublishProjectType>
    <PublishProjectType Condition="'$(PublishProjectType)' == '' and '$(OutputType)' == 'Library'">WebApp</PublishProjectType>
    <PublishProjectType Condition="'$(PublishProjectType)' == '' ">WebSite</PublishProjectType>
  </PropertyGroup>

  <Import Project="$(DotNetPublishingCollectFilesDirectory)Microsoft.DotNet.$(PublishProjectType).Publishing.CollectFiles.targets" Condition="Exists('$(DotNetPublishingCollectFilesDirectory)Microsoft.DotNet.$(PublishProjectType).Publishing.CollectFiles.targets')" />

    <!-- Extension points for pre-publish and post-publish events-->
  <Target Name="PrePublish" />
  <Target Name="BeforeCollectFiles" />
  <Target Name="AfterCollectFiles" />
  <Target Name="BeforePublishFiles" />
  <Target Name="AfterPublishFiles" />
  <Target Name="PostPublish" />

  <!--
  ***********************************************************************************************
  Import the PublishProfiles
  ***********************************************************************************************
 -->

  <PropertyGroup>
    <PublishProfileRootFolder Condition="'$(PublishProfileRootFolder)' == '' and '$(MSBuildProjectExtension)' =='.vbproj' ">$(MSBuildProjectDirectory)\My Project\PublishProfiles\</PublishProfileRootFolder>
    <PublishProfileRootFolder Condition="'$(PublishProfileRootFolder)' == '' and '$(MSBuildProjectExtension)' =='.csproj' ">$(MSBuildProjectDirectory)\Properties\PublishProfiles\</PublishProfileRootFolder>
    <PublishProfile Condition="'$(PublishProfile)' ==''">FileSystemProfile</PublishProfile>
    <PublishProfileName Condition="'$(PublishProfileName)' == ''">$([System.IO.Path]::GetFileNameWithoutExtension($(PublishProfile)))</PublishProfileName>
    <PublishProfileFullPath Condition="'$(PublishProfileFullPath)' == ''">$(PublishProfileRootFolder)$(PublishProfileName).pubxml</PublishProfileFullPath>
    <PublishProfileFullPath Condition="!Exists('$(PublishProfileFullPath)')">$(DotNetPublishingProfilesDirectory)$(PublishProfileName).pubxml</PublishProfileFullPath>

    <!-- This is what get passed from the Visual Studio UI.-->
    <WebPublishProfileFile Condition="'$(WebPublishProfileFile)' == ''">$(PublishProfileFullPath)</WebPublishProfileFile>
  </PropertyGroup>

  <Import Project="$(WebPublishProfileFile)" Condition="Exists('$(WebPublishProfileFile)')" />

  <!--
  ***********************************************************************************************
  Import the PublishProtocol target
  ***********************************************************************************************
 -->

  <PropertyGroup>
    <PublishProtocol Condition="'$(PublishProtocol)' == ''">$(WebPublishMethod)</PublishProtocol>
  </PropertyGroup>
  
  <Import Project="$(DotNetPublishingDeployFilesDirectory)Microsoft.$(PublishProtocol).Publishing.targets" Condition="Exists('$(DotNetPublishingDeployFilesDirectory)Microsoft.$(PublishProtocol).Publishing.targets')"/>
  
  <!--
  ***********************************************************************************************
  TARGET : DotNetPublish
  ***********************************************************************************************
 -->
  <PropertyGroup>
    <DotNetPublishDependsOn>
      PrePublish;
      CorePublish;
      PostPublish;
    </DotNetPublishDependsOn>
  </PropertyGroup>

  <Target Name="DotNetPublish" 
          DependsOnTargets="$(DotNetPublishDependsOn)" 
          AfterTargets="Build" 
          Condition=" '$(PublishOnBuild)' =='true' " />

  <PropertyGroup>
    <CorePublishDependsOn>
      $(CorePublishDependsOn);
      BeforeCollectFiles;
      $(DotNetPublishCollectFiles);
      AfterCollectFiles;
      $(DotNetPublishSaveFiles);
      BeforePublishFiles;
      $(DotNetPublishFiles);
      AfterPublishFiles;
    </CorePublishDependsOn>
  </PropertyGroup>
  
  <Target Name="CorePublish"
          DependsOnTargets="$(CorePublishDependsOn)" />
  

</Project>
